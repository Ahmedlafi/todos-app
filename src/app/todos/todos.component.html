<div class="add-todo-section">
  <mat-card class="add-todo-card">
    <mat-card-header>
      <mat-card-title>Add New Task</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="addTodoForm" (ngSubmit)="onAddTodo()">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Add New Task </mat-label>
          <input
            matInput
            formControlName="todo"
          />
          <mat-error *ngIf="addTodoForm.get('todo')?.hasError('required')">
            Task description is required
          </mat-error>
          <mat-error *ngIf="addTodoForm.get('todo')?.hasError('minlength')">
            Task must be at least 3 characters
          </mat-error>
        </mat-form-field>

        <div class="status-toggle">
          <mat-slide-toggle
            formControlName="completed"
            color="primary"
            class="status-toggle-control"
          >
            <span class="toggle-label">
              {{ addTodoForm.get("completed")?.value ? "Completed" : "To Do" }}
            </span>
          </mat-slide-toggle>
        </div>
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="addTodoForm.invalid || addingTodo"
          class="add-button"
        >
          <mat-icon>add</mat-icon>
          {{ addingTodo ? "Adding..." : "Add Task" }}
        </button>
      </form>
    </mat-card-content>
  </mat-card>
</div>

<div class="todos-container" *ngIf="!loading; else loadingTpl">
  <div class="column">
    <h2>To Do</h2>
    <div
      cdkDropList
      [cdkDropListData]="todos"
      [cdkDropListConnectedTo]="['completedList']"
      id="todoList"
      class="task-list"
      (cdkDropListDropped)="drop($event)"
    >
      <mat-card
        *ngFor="let task of todos"
        cdkDrag
        (click)="viewDetails(task.id, $event)"
        class="clickable-card"
      >
        <div class="task-content">
          <mat-icon class="drag-handle">drag_indicator</mat-icon>
          <span class="task-text">{{ task.todo }}</span>
          <button
            mat-icon-button
            color="warn"
            (click)="deleteTodo(task.id, $event)"
            class="delete-btn"
            matTooltip="Delete task"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </mat-card>
    </div>
  </div>

  <div class="column">
    <h2>Completed</h2>
    <div
      cdkDropList
      [cdkDropListData]="completed"
      [cdkDropListConnectedTo]="['todoList']"
      id="completedList"
      class="task-list"
      (cdkDropListDropped)="drop($event)"
    >
      <mat-card
        *ngFor="let task of completed"
        cdkDrag
        (click)="viewDetails(task.id, $event)"
        class="done clickable-card"
      >
        <div class="task-content">
          <mat-icon class="drag-handle">drag_indicator</mat-icon>
          <span class="task-text">{{ task.todo }}</span>
          <button
            mat-icon-button
            color="warn"
            (click)="deleteTodo(task.id, $event)"
            class="delete-btn"
            matTooltip="Delete task"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </mat-card>
    </div>
  </div>
</div>

<ng-template #loadingTpl>
  <p style="text-align: center">Loading...</p>
</ng-template>
